<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="/node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/node_modules/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" />
    <link href="/tradeModal.css" rel="stylesheet" />
    <script src="/node_modules/jquery/dist/jquery.min.js"></script>
    <script src="/node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="tradeModal.js"></script>
    <title>Hello, world!</title>
</head>

<body>

    <button class="buy-button btn btn-success" data-symbol="ASHOKLEY" data-price="120" data-trade-type="buy" data-quantity="10">B</button> 
    <button class="sell-button btn btn-danger" data-symbol="ASHOKLEY" data-price="120" data-trade-type="sell">S</button> 
    <script>
        $(document).ready(function () {
            $(".buy-button, .sell-button").tradeModal({
                onSubmit:function(data){
                    console.log("data filled in form: ", data);
                    const obj={
                        order_stock_cd: data.symbol,
                        order_xchng_cd: "NSE",
                        order_product: data.product=="cnc"?"CASH":"MARGIN",
                        order_type:data.order="market"?"M":"L",
                        order_validity:data.validity=="day"?"T":"I",
                        order_quantity:data.quantity,
                        order_rate: data.order="market"?0:data.price,
                        order_flow: data.tradeType=="buy"?"B":"S",
                        order_stp_loss_price: data.stoploss,
                        order_disclosed_qty: data.discQuantity                        
                    };
                    $(this).tradeModal("loading", true);

                    $.ajax({
                        url:"/icici",
                        context:$(this),
                        data:{
                            action:"cashOrder",
                            subAction:"placeCashOrder",
                            JSONPostData: JSON.stringify(obj)
                        },
                        type:"post",
                        complete:function(){
                            $(this).tradeModal("loading", false);                            
                        },
                        success:function(data){
                            console.log(data);
                            if(data.Status!="200"){

                                return;
                            }

                            $(this).tradeModal("success", 'Successfully placed order.');
                        }
                    });
                }
            });
        });
    </script>
</body>

</html>